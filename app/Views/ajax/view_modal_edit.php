<!-- Modal -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header bg-primary text-white">
				<h5 class="modal-title" id="exampleModalLabel"><i class="fas fa-edit"></i> Edit Products</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<?= form_open('ajax-jquery/update_data', ['class' => 'form-edit']); ?>
			<?= csrf_field(); ?>
			<input type="hidden" name="id" value="<?= $id; ?>">
			<div class="modal-body">
				<div class="form-group row">
					<label for="name" class="col-sm-2 col-form-label">Name</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" id="name" name="name" value="<?= $name; ?>">
						<div class="invalid-feedback errorName">

						</div>
					</div>
				</div>

				<div class="form-group row">
					<label for="description" class="col-sm-2 col-form-label">Description</label>
					<div class="col-sm-10">
						<textarea name="description" id="description" cols="80" rows="4" class="form-control"><?= $description; ?></textarea>
						<div class="invalid-feedback errorDesc">

						</div>
					</div>
				</div>

				<div class="form-group row">
					<label for="price" class="col-sm-2 col-form-label">Price</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" id="price" name="price" value="<?= $price; ?>">
						<div class="invalid-feedback errorPrice">

						</div>
					</div>
				</div>

				<div class="form-group row">
					<label for="date" class="col-sm-2 col-form-label">Date</label>
					<div class="col-sm-10">
						<input type="date" class="form-control" id="date" name="date" value="<?= $date; ?>">
						<div class="invalid-feedback errorDate">

						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
				<button type="submit" class="btn btn-primary btn-sm btn-update">Update</button>
			</div>
			<?= form_close(); ?>
		</div>
	</div>
</div>

<script>
	$(document).ready(function() {
		$('.form-edit').submit(function(e) {
			e.preventDefault();
			$.ajax({
				type: "post",
				url: $(this).attr('action'),
				data: $(this).serialize(),
				dataType: "json",
				beforeSend: function() {
					$('.btn-update').attr('disable', 'disabled');
					$('.btn-update').html('<i class="fas fa-spin fa-spinner"></i>');
				},
				complete: function() {
					$('.btn-update').removeAttr('disable');
					$('.btn-update').html('Update');
				},
				success: function(response) {
					if (response.error) {
						if (response.error.name) {
							$('#name').addClass('is-invalid');
							$('.errorName').html(response.error.name);
						} else {
							$('#name').removeClass('is-invalid');
							$('.errorName').html('');
						}

						if (response.error.description) {
							$('#description').addClass('is-invalid');
							$('.errorDesc').html(response.error.description);
						} else {
							$('#description').removeClass('is-invalid');
							$('.errorDesc').html('');
						}

						if (response.error.price) {
							$('#price').addClass('is-invalid');
							$('.errorPrice').html(response.error.price);
						} else {
							$('#price').removeClass('is-invalid');
							$('.errorPrice').html('');
						}

						if (response.error.date) {
							$('#date').addClass('is-invalid');
							$('.errorDate').html(response.error.date);
						} else {
							$('#date').removeClass('is-invalid');
							$('.errorDate').html('');
						}

					} else {
						Swal.fire({
							icon: 'success',
							title: 'Success',
							text: response.success,
							showConfirmButton: false,
							timer: 1800
						})

						$('#editModal').modal('hide');
						getProducts();
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(xhr.status + "\n" + xhr.responseText + "\n" + thrownError);
				}
			});
			return false;
		});
	});
</script>